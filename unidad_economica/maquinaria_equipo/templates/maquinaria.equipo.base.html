{% extends 'base.template.html' %}
{% load static from staticfiles %}
{% load i18n %}
{% block content_header_title %}{% trans 'Maquinaria y Equipos' %}{% endblock %}
{% block content_header_roadmap %}
    <li class="active">{% trans 'Maquinaria y Equipos' %}</li>
{% endblock %}
{% block contenido %}
    <form action="" role="form" class="form form-horizontal validate-form" method="post" autocomplete="off">
        {% csrf_token %}
        <div class="box box-primary box-registro-general">
            <div class="box-header with-border">
                <h3 class="box-title">
                    <i class="glyphicon glyphicon-edit"></i>&#160;{% trans 'Datos de las maquinarias y equipos' %}
                </h3>
            </div>
            <div class="box-body">
                <div class="row">
                    <div class="col-md-6 col-sm-6 col-xs-6">
                        <div class="form-group {% if form.sub_unidad_economica.errors %}has-error{% endif %}">
                            <label class="col-md-4 col-xs-4 col-sm-4 control-label" for="{{ form.sub_unidad_economica.auto_id }}">
                                {{ form.sub_unidad_economica.label }}
                            </label>
                            <div class="col-md-7 col-xs-7 col-sm-7">
                                {{ form.sub_unidad_economica }}
                                {% include 'base.form.errors.html' with form_errors=form.sub_unidad_economica.errors col_title_error='col-sm-2' col_msg_error='col-sm-10' %}
                            </div>
                            <div class="col-md-1 col-xs-1 col-sm-1">
                                <i class="ion ion-ios-medical item-requerido-nomargin"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-sm-6 col-xs-6">
                        <div class="form-group {% if form.nombre_proceso.errors %}has-error{% endif %}">
                            <label class="col-md-4 col-xs-4 col-sm-4 control-label" for="{{ form.nombre_proceso.auto_id }}">
                                {{ form.nombre_proceso.label }}
                            </label>
                            <div class="col-md-7 col-xs-7 col-sm-7">
                                {{ form.nombre_proceso }}
                                {% include 'base.form.errors.html' with form_errors=form.nombre_proceso.errors col_title_error='col-sm-2' col_msg_error='col-sm-10' %}
                            </div>
                            <div class="col-md-1 col-xs-1 col-sm-1">
                                <i class="ion ion-ios-medical item-requerido-nomargin"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 col-sm-6 col-xs-6">
                        <div class="form-group {% if form.nombre_maquinaria.errors %}has-error{% endif %}">
                            <label class="col-md-4 col-xs-4 col-sm-4 control-label" for="{{ form.nombre_maquinaria.auto_id }}">
                                {{ form.nombre_maquinaria.label }}
                            </label>
                            <div class="col-md-7 col-xs-7 col-sm-7">
                                {{ form.nombre_maquinaria }}
                                {% include 'base.form.errors.html' with form_errors=form.nombre_maquinaria.errors col_title_error='col-sm-2' col_msg_error='col-sm-10' %}
                            </div>
                            <div class="col-md-1 col-xs-1 col-sm-1">
                                <i class="ion ion-ios-medical item-requerido-nomargin"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-sm-6 col-xs-6">
                        <div class="form-group {% if form.pais_origen.errors %}has-error{% endif %}">
                            <label class="col-md-4 col-xs-4 col-sm-4 control-label" for="{{ form.pais_origen.auto_id }}">
                                {{ form.pais_origen.label }}
                            </label>
                            <div class="col-md-7 col-xs-7 col-sm-7">
                                {{ form.pais_origen}}
                                {% include 'base.form.errors.html' with form_errors=form.pais_origen.errors col_title_error='col-sm-2' col_msg_error='col-sm-10' %}
                            </div>
                            <div class="col-md-1 col-xs-1 col-sm-1">
                                <i class="ion ion-ios-medical item-requerido-nomargin"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 col-sm-6 col-xs-6">
                        <div class="form-group {% if form.descripcion_maquinaria.errors %}has-error{% endif %}">
                            <label class="col-md-4 col-xs-4 col-sm-4 control-label" for="{{ form.descripcion_maquinaria.auto_id }}">
                                {{ form.descripcion_maquinaria.label }}
                            </label>
                            <div class="col-md-7 col-xs-7 col-sm-7">
                                {{ form.descripcion_maquinaria }}
                                {% include 'base.form.errors.html' with form_errors=form.descripcion_maquinaria.errors col_title_error='col-sm-2' col_msg_error='col-sm-10' %}
                            </div>
                            <div class="col-md-1 col-xs-1 col-sm-1">
                                <i class="ion ion-ios-medical item-requerido-nomargin"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-sm-6 col-xs-6">
                        <div class="form-group {% if form.date.errors %}has-error{% endif %}">
                            <label class="col-md-4 col-xs-4 col-sm-4 control-label" for="{{ form.date.auto_id }}">
                                {{ form.date.label }}
                            </label>
                            <div class="col-md-7 col-xs-7 col-sm-7">
                                <div class="form-inline" >
                                    <div class="input-group">
                                        {{ form.date }}
                                        <div class="input-group-addon"><i class="fa fa-calendar"></i></div>
                                    </div>
                                </div>
                                {% include 'base.form.errors.html' with form_errors=form.date.errors col_title_error='col-sm-2' col_msg_error='col-sm-10' %}
                            </div>
                            <div class="col-md-1 col-xs-1 col-sm-1">
                                <i class="ion ion-ios-medical item-requerido-nomargin"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 col-sm-6 col-xs-6">
                        <div class="form-group {% if form.vida_util.errors %}has-error{% endif %}">
                            <label class="col-md-4 col-xs-4 col-sm-4 control-label" for="{{ form.vida_util.auto_id }}">
                                {{ form.vida_util.label }}
                            </label>
                            <div class="col-md-7 col-xs-7 col-sm-7">
                                {{ form.vida_util }}
                                {% include 'base.form.errors.html' with form_errors=form.vida_util.errors col_title_error='col-sm-2' col_msg_error='col-sm-10' %}
                            </div>
                            <div class="col-md-1 col-xs-1 col-sm-1">
                                <i class="ion ion-ios-medical item-requerido-nomargin"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-sm-6 col-xs-6">
                        <div class="form-group {% if form.date_adquisicion.errors %}has-error{% endif %}">
                            <label class="col-md-4 col-xs-4 col-sm-4 control-label" for="{{ form.date_adquisicion.auto_id }}">
                                {{ form.date_adquisicion.label }}
                            </label>
                            <div class="col-md-7 col-xs-7 col-sm-7">
                                <div class="form-inline" >
                                    <div class="input-group">
                                        {{ form.date_adquisicion }}
                                        <div class="input-group-addon"><i class="fa fa-calendar"></i></div>
                                    </div>
                                </div>
                                {% include 'base.form.errors.html' with form_errors=form.date_adquisicion.errors col_title_error='col-sm-2' col_msg_error='col-sm-10' %}
                            </div>
                            <div class="col-md-1 col-xs-1 col-sm-1">
                                <i class="ion ion-ios-medical item-requerido-nomargin"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 col-sm-6 col-xs-6">
                        <div class="form-group {% if form.estado_actual.errors %}has-error{% endif %}">
                            <label class="col-md-4 col-xs-4 col-sm-4 control-label" for="{{ form.estado_actual.auto_id }}">
                                {{ form.estado_actual.label }}
                            </label>
                            <div class="col-md-7 col-xs-7 col-sm-7">
                                {{ form.estado_actual }}
                                {% include 'base.form.errors.html' with form_errors=form.estado_actual.errors col_title_error='col-sm-2' col_msg_error='col-sm-10' %}
                            </div>
                            <div class="col-md-1 col-xs-1 col-sm-1">
                                <i class="ion ion-ios-medical item-requerido-nomargin"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!--###################################################################################-->

                <div class="row form-group {% if form.nombre_proceso_tb.errors %}has-error{% endif %}">
                    <div class="col-md-12 col-sm-12 col-xs-12">
                        <label></label>
                        <a class="btn btn-primary btn-sm pull-right" id="#dtable" onclick="add_field_datatable(['#id_nombre_proceso','#id_nombre_maquinaria','#id_pais_origen','#id_descripcion_maquinaria'],'#mydtable');">
                            {% trans 'Agregar Maquinaria' %}
                        </a>
                    </div>
                </div>

                {% include 'carga.masiva.template.html' with app='maquinaria_equipo' mod='maquinariaModel' %}

                <div class="row">
                    <div class="col-md-12 col-sm-12 col-xs-12 text-center">
                        <h5 class="titulo text-center">{% trans 'Lista de Maquinarias y Equipos' %}</h5>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12 col-sm-12 col-xs-12">
                        <table class="table table-striped table-hover display dataTable" id="mydtable">
                            <thead>
                                <tr>
                                    <th>{% trans 'Sub Unidad' %}</th>
                                    <th>{% trans 'Proceso Productivo' %}</th>
                                    <th>{% trans 'Maquinaria / Equipo' %}</th>
                                    <th>{% trans 'Pais de Origen' %}</th>
                                    <th>{% trans 'Descripción' %}</th>
                                    <th>{% trans 'Año de Fabricacion' %}</th>
                                    <th>{% trans 'Vida ultil' %}</th>
                                    <th>{% trans 'Año de Adquisicion' %}</th>
                                    <th>{% trans 'Estado Actual' %}</th>
                                </tr>
                            </thead>
                        </table>
                        {% if form.nombre_proceso_tb.errors or form.tipo_proceso_tb.errors or form.descripcion_proceso_tb.errors or form.estado_proceso_tb.errors%}
                            <p class="bg-warning">
                                <span class="help-block msg-error">
                                    {% trans 'Debe agregar al menos una Maquinaria o Equipo' %}
                                </span>
                            </p>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="box-footer text-right">
                {% include 'base.form.buttons.html' %}
                <button type="submit" class="btn btn-primary btn-sm" data-toggle="tooltip">{% trans 'Finalizar' %}</button>
            </div>
        </div>
    </form>
{%endblock%}
{% block extra_footer %}
    <script type="text/javascript">
        $(document).ready(function(){
            remove_field_datatable('#mydtable');
            update_field_datatable('#mydtable','#mymaquinaria',
                ['#id_nombre_proceso','#id_nombre_maquinaria','#id_pais_origen','#id_descripcion_maquinaria']);
            
            $('.fileinput-upload-button').click(function(event){
                event.preventDefault();
                var file = $('#carga_masiva-maquinariaModel')[0];
                var fdata = new FormData();
                fdata.append('file',file.files[0]);
                fdata.append('csrfmiddlewaretoken','{{ csrf_token }}');
                //var models = '?app=maquinaria_equipo&mod=maquinariaModel&anho=2016&rel_id=1&rel_app=sub_unidad_economica&rel_mod=SubUnidadEconomicaProceso';
                var models = '?app=maquinaria_equipo&mod=maquinariaModel&anho=2016&father_id=1';
                $.ajax({
                    url: URL_CARGAR_ARCHIVO_CM+models,
                    data: fdata,
                    contentType: false,
                    processData: false,
                    type: 'POST',
                    success: function(data){
                        console.log(data);
                    },
                    error: function(error){
                        console.log(error);
                    }
                });
            });
        });
        
    </script>


     <script type="text/javascript">
         $(function() {
             $('.datepicker').datepicker({
                 //disabledDates: 'date',
                 viewMode: 2,
                 daysOfWeekDisabled: [0, 6],
                 disabledMonth: true,
                 inline: true,
                 sideBySide: true,
                 changeYear: true,
                 showButtonPanel: true,
                 dateFormat: 'yyyy',
                 onClose: function(dateText, inst) {
                     var year = $('#ui-datepicker-div .ui-datepicker-year :selected').val();
                     $(this).datepicker('setDate', new Date(year, 1));
                }
            });
        $('.datepicker').focus(function () {
                $('.ui-datepicker-days').hide();
                $('.ui-datepicker-month').hide();
            });
        });
     </script>
{% endblock %}